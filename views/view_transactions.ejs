<%- include("header.ejs") %>

<body>
  <%- include("navbar.ejs")%>
  <div style="margin-top: 15px; margin-left: 40px; margin-right: 40px;">
    <form class="col-sm-10" action="/transaction_all" method="post">
        <div class="input-group">
            <label for="name">From </label> <input type="date" class="form-control" id="from_date" name="from_date" placeholder="From"/>
            <span class="input-group-addon">---</span>
            <label for="name">To</label> <input type="date" id ="to_date"  name="to_date" class="form-control" placeholder="To"/>
        </div>
       
<button type="submit" class="btn " style="background-color: #eb2d53; margin-top: 4px; margin-left: 965px;"> Submit</button>
        </form>
  
        <h3 style="margin-top: 30px ; margin-right: 20px; margin-left: 8px;">
          <span>Transactions </span>
          <input type="search" placeholder="Search..." class="form-control search-input" data-table="customers-list"/>
      </h3>
  <% if(transaction != null) {%>
    <div class="alert alert-info" role="alert" style="margin: 5px; margin-left:8px ; margin-right: 20px;">
      Total Revenue  = Rs.<label id="result">x 
  </div>
  <div class="d-flex justify-content-center" style="margin-top: 5px; margin-left: 8px; margin-right: 20px;">

   

    <table class="table table-striped mt32 customers-list" style="background-color: white;">
      <thead>
       
      <tr>
        <th >Id</th>
        <th >Type</th>
        <th >Product_Id</th>
        <th >Quantity</th>
        <th >Date</th>
        <th>Price_per_unit</th>
        <th>Total Price</th>

      </tr>
      
      
    </thead>
    
        <% 
        console.log("view trans")
        console.log(transaction);
        var sale_sum = 0;
        var buy_sum = 0;
        var revenue = 0;
        var type_p = " "
        var total_price = 0;

        for(let i = 0; i<transaction.length; i++){ 
             type_p = transaction[i].type;
             total_price =((transaction[i].price_per_unit)*(transaction[i].quantity));
            if(type_p =='sales' || type_p =='sale' ){
                sale_sum =( sale_sum + total_price);
            }
            else if (type_p =='buy'){
                buy_sum = (buy_sum + total_price);
            }
        %>
        <tbody>
      <tr>
        <th ><%=transaction[i].id%></th>
        <td class="cp"><%=transaction[i].type%></td>
        <td><%=transaction[i].product_id%></td>
        <td><%=transaction[i].quantity%></td>
        <td><%=moment(transaction[i].p_date).format( 'MM/DD/YYYY')%></td>
        <td><%="Rs."+transaction[i].price_per_unit%></td>
        <td class="qt"> <%="Rs."+total_price%></td>
      </tr>
      <% }; 
        revenue = (sale_sum - buy_sum)
      %> 
    </tbody>
    </table>

    </div>
    <div>
   
    
    </div>
</div>
<%   %>


<% } else {  %>  
    <p> NO data found</p>
    <% } %>

    <script type="text/javascript">
                var numbers = document.querySelectorAll(".cp");
	var numb = document.querySelectorAll(".qt");
var total = 1;
var sum = 0;
      console.log(numbers)
      console.log(numb)
      for (var i = 0; i < numbers.length; i++){
        console.log(Number(numb[i].innerText))
      }


document.getElementById("result").innerText = sum;
		

    </script>
    <script src="trans_view.js" />

</body>
  <%- include("footer.ejs") %>