<%- include("header.ejs") %>

<body>
  <%- include("navbar.ejs")%>
  <div style="margin-top: 15px; margin-left: 40px; margin-right: 40px;">
    <form class="col-sm-10" action="/transaction_all" method="post">
        <div class="input-group">
            <label for="name">From </label> <input type="date" class="form-control" id="from_date" name="from_date" placeholder="From"/>
            <span class="input-group-addon">---</span>
            <label for="name">To</label> <input type="date" id ="to_date"  name="to_date" class="form-control" placeholder="To"/>
        </div>
       
<button type="submit" class="btn btn-primary" style="margin-top: 2px;"> Submit</button>
        </form>
  
        <h3 style="margin-top: 30px ;">
          <span>Transactions </span>
          <input type="search" placeholder="Search..." class="form-control search-input" data-table="customers-list"/>
      </h3>
  <% if(transaction != null) {%>
    <div class="alert alert-info" role="alert" style="margin: 5px; margin-left:10px ; margin-right: 20px;">
      Total Revenue  = Rs.<label id="result">x 
  </div>
  <div class="d-flex justify-content-center" style="margin-top: 5px; margin-left: 20px; margin-right: 10px;">

   

  <table class="table table-striped mt32 customers-list">
    <thead class="thead-dark">
       
      <tr>
        <th scope="col">Id</th>
        <th scope="col">Type</th>
        <th scope="col">Product_Id</th>
        <th scope="col">Quantity</th>
        <th scope="col">Date</th>
        <th scope="col">Price_per_unit</th>
        <th scope="col">Total Price</th>

      </tr>
      
      
    </thead>
    
        <% 
        console.log("view trans")
        console.log(transaction);
        var sale_sum = 0;
        var buy_sum = 0;
        var revenue = 0;
        var type_p = " "
        var total_price = 0;

        for(let i = 0; i<transaction.length; i++){ 
             type_p = transaction[i].type;
             total_price =((transaction[i].price_per_unit)*(transaction[i].quantity));
            if(type_p =='sales' || type_p =='sale' ){
                sale_sum =( sale_sum + total_price);
            }
            else if (type_p =='buy'){
                buy_sum = (buy_sum + total_price);
            }
        %>
        <tbody id="myTable">
      <tr>
        <th scope="row"><%=transaction[i].id%></th>
        <td class="type"><%=transaction[i].type%></td>
        <td><%=transaction[i].product_id%></td>
        <td><%=transaction[i].quantity%></td>
        <td><%=moment(transaction[i].p_date).format( 'MM/DD/YYYY')%></td>
        <td><%="Rs."+transaction[i].price_per_unit%></td>
        <td class="tp"><%="Rs."+total_price%></td>
      </tr>
      <% }; 
        revenue = (sale_sum - buy_sum)
      %> 
    </tbody>
    </table>

    </div>
    <div>
   
    
    </div>
</div>
<%   %>


<% } else {  %>  
    <p> NO data found</p>
    <% } %>
    <script type="text/javascript">
                var total_price = document.querySelectorAll(".tp");
	var type = document.querySelectorAll(".type");
var buys_sum = 0;
var sell_sum = 0;
var t = " ";
var revenue = 0;

for (var i = 0; i < total_price.length; i++)
{   
    t =Number(type[i].innerText);
    if(t == 1){
      buys_sum += Number(total_price[i].innerText);

    }
    else if( t == 0){
      sell_sum += Number(total_price[i].innerText);
    }
    if(sell_sum == 0){
      revenue = 0
    }
    else{
    revenue = sell_sum - buys_sum;
    }
    
}

document.getElementById("result").innerText = revenue;
		

    </script>
    <script src="trans_view.js" />

</body>
  <%- include("footer.ejs") %>